>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 2nd Project Syspro <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<

Aristi Papastavrou
AM: 1115201800154

>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> Compiling Options  <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<

Για να φτιάξετε νέο input File με records αλλά ταυτόχρονα να κάνετε και compile τα files του προγράμματος, αρκεί να γράψετε στο terminal: make script NUM_FILES_PER_DIR=x
όπου x o αριθμός αρχείων ανά directory.
Αλλιώς αν θέλετε να χρησιμοποιήστε το ήδη υπάρχον input file, απλά γράψτε στο terminal: make all
Eάν θέλετε απλά να φτιάξετε το input_file γράψτε: bash ./create_infiles.sh input_dir/inputFile.txt input_dir2 numfiles
όπου τα x και y είναι τα ίδια όπως παραπάνω.

Για την εκτέλεση του προγράμματος πληκτρολογήστε: ./travelMonitor -m 3 -b 100 -s 1000 -i input_dir
Εάν θέλετε να το τρέξετε με valgrind : valgrind --leak-check=full --show-leak-kinds=all --trace-children=yes -s ./travelMonitor -m 3 -b 100 -s 1000 -i input_dir (αντικαθιστώντας με τις 
τιμές που θέλετα κάθε φορά)
Για διαγραφή των εκτελέσιμων πληκτρλογήστε: make clean

>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>

~ > Script: Κινείται στην ίδια λογική με το script της προηγούμενης εργασίας το οποίο και θα βρείτε μέσα στο folder της 2ης εργασίας.Το παλιό script εκτελείεται μέσα στο νέο script για να 
			δημιουργήσω ένα νέο input file πάνω στο οποίο θα βασιστώ για να μοιράσω τα records στα country directories.Να σημειωθεί ότι επειδή είχε ειπωθεί πως δεν θα βρούμε διπλότυπα records σε άλλες χώρες το παλίο script εκτελείται με duplicates flag=0.

~ > Structures: έχω χρησιμοποιήσει τις ίδιες δομές με την 1η εργασία, δηλαδή ένα linear probing hashtable,bloom filters,skipped lists και Doubly Linked List.
~ > Kάθε monitor struct αποθηκεύει πέρα του pid του και του write_p,read_p και μια λίστα από χώρες για να ξέρουμε μετα σε ποια folders πρέπει να ψάξει
~ > Write/Read message to/from pipe protocol: Η μεθοδολογία που έχω ακολουθήσει είναι βασισμένη στο πρωτόκολο που περιγράφεται στο βιβλίο του Kerrisk.Δηλαδή το message που στέλνω στο pipe 
									είναι δομημένο ως εξής:Στην αρχή του μηνύματος γράφουμε το opcode,μετά τα bytes του μηνύματος που θα στείλουμε και σε τελικό στάδιο το μήνυμα
									Και η write και η read είναι δομημένες με παρόμοιο τρόπο.Η διαφορά στην read είναι ότι έχουμε μια επιπρόσθετη συνάρτηση που αγνοεί τα signals μέχρι να καταφέρει το πρόγραμμα να διαβάσει από το named pipe και μετά επιστρέφει.Ακόμη στην main του travelMonitor δημιουργούμε ένα bloom filter, ετσι ώστε όταν διαβάζουμε μήνυμα που περιέχει ένα bloom filter να το μεταφέρουμε εκεί και να το περνάμε στις ανάλογες συναρτήσεις.

~ > Στο 1ο στάδιο που οι monitors διαβάζουν τα διάφορα αρχεία και αρχικοποιούν τις δομές,στέλνουν τα bloom filters στον travel monitor, δεν κάνω bitwise or τα bloom filters στον travel 		monitor αλλά τα αποθηκεύω όλα σε μια λίστα και το κάθε bloom filter έχει και μια λίστα από country names για να ξέρουμε από ποιες χώρες έχει data.  
~ > /addVaccinationRecords: Σε 1ο στάδιο βρίσκω ποιο monitor χειρίζεται το country που δόθηκε σε παράμετρο και στέμνω μήνυμα στον monitor αυτο το countryname, έτσι ώστε να το αποθηκεύσει 	σε μια τοπική μεταβλητή.Όταν ο monitor μας ενημερώσει ότι είναι έτοιμος, στέλνουμε μέσω kill ένα signal usr1 στον monitor για να πάει με την σειρά του να βρει το/τα νέα files.
Το bloom filter που φτιάχνει ο monitor το κάνουμε bitwise or με το προυπάρχον bloom filter του monitor και το στέλνουμε στον Travel monitor για να κάνει update.
Για να βρω ποι αείναι τα νέα files προσπευλαύνω μια λίστα που περιέχει τα filenames που έχει επεξεργαστεί μέχρι στιγμής ο monitor και αν δεν βρω κάποιο από τα files που υπάρχουν πλέον στο directory ξέρω ότι αυτό είναι για διάβασμα.

~ > Για το travel stats query φτιάχνω μια λίστα με viruses, όπου κάθε κόμβος περιέχει μια λίστα, της οποίας οι κόμοι αποτελούνται από μία χώρα και μια λίστα από booleans για να ξέρω αν τα requests ήταν accepted/rejected.Οπότε με ένα απλό parsing μετα βρίσκω το αποτέλσμα.
~ > Στα output logs εκμεταλεύομαι την λίστα με τα stats και αφού δημιυργήσω ένα logs folder (το σβήνω πρώτα αν ήδη υπάρχει από προηγούμενο τρέξιμο) με ένα parsing στο travel stats 
συμπληρώνω το log file του αντίστοιχου μονιτορ
~> Tο signal handling μου είναι αρκετά απλό και βασική ιδέα είναι σε κάθε φάση όταν γίνεται read από pipe αγνοούμε τα σήματα,όταν γίνεται οποιοδήποτε command processing 
κάνουμε πρώτα signal block και μετά unblock.Eνώ για το configuration βασίστηκα στο https://pubs.opengroup.org/onlinepubs/007904875/functions/sigaction.html για να κάνω σωστή αρχικοποιήση

~>Στο travelRequest αρχικά κάνω ένα search στα bloom filters του travel monitor.Εαν βγει αρνητικό το search τότε σίγουρα δεν υπάρχει recorde γιαυτο το vaccination και δεν χρειάζεται να επικοινωνήσουμε με το monitor.Αλλίως πάω στο αντίστοιχο monitor και ψάχνω στις skipped lists του μιας και παρέχουν πιο σίγουρο αποτέλεσμα.

~ > /searchVaccinationStatus: Aντίστοιχα στέλνω μήνυμα σε όλους τους monitors οι οποίοι ψάχνουν στα citizen hashtables τους για το citizen id που έλαβε μέσω μηνύματος.
Εάν δεν το βρει απλά κάνει return.Αλλιώσ στέλνει μέσω pipe ένα message που περιέχει όλα τα στοιχεία εμβολιασμόυ του citizen.

~> /exit: Στλελνω kill signal σε όλα τα monitors που έχουν γίνει forked, περιμένω να διαγραφολυν και σε δεύτερη φάση διαγράφω τα structs του travel monitor.

>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
NOTES: Έχω κάνει define το bloom size μιας και παρατήρησα ότι για μέγεθος 10000 ανιμετωπίζει κάποιο πρόβλημα και κρασάρει ενώ για μέγεθος 1000 δουλεύει κανονικά.Οπότε αν και παίρνω user input για το bloom filter εάν βάλει παραπάνω από 1000 το αλλάζω.Τέλος έχει υλοποιηθεί κανονικά το query /addVaccinationRecords country αλλά αν και έχω φτιάξει τον signal handler για να 
επεξεργάζεται τα σήματα SIGUSR1,SIGINT κλπ,δεν θα διαβάσει τα νέα files εάν απλά λάβει SIGUSR1 και ´οχι μέχω του query.Τέλος αν και έχω υλοποιήσει συνάρτηση όπου σε περίπτωση που πεθάνει ένα παιδί να μοιράζει τις χώρες του σε άλλα monitors και αντίστοιχα να αρχικοποιούν τις δικές τους δομές , δεν την καλώ γιατί δεν πρόλαβα να κάνω επαρκές debugging στο κομμάτι αυτό και δεν θα ήθελα να δημιουργήσει προβήματα στο πρόγραμμα μου
Στο info dir έχω φτιάξει ένα υποτυπώδες file Greece--11.txt το οποίο μπορείτε να το προσθέσετε στο Greece folder αφού έχετε τρέξει το πρόγραμμα
για να εξακριβώσετε την λειτουργικότητα του /addVaccinationRecords.
>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>